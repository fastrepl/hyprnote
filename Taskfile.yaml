version: '3'
dotenv: ['.env.local']
tasks:
  fmt:js: pnpm -r format
  fmt:yaml: yamlfmt .github pnpm-workspace.yaml
  fmt:toml: taplo fmt apps/**/Cargo.toml crates/**/Cargo.toml *.toml
  fmt:rs: cargo fmt
  fmt:sql: sleek "**/*.sql"
  fmt:swift: find crates -type f \( -name "*.swift" \) -not -path "*/\.build/*" | xargs swift-format format -i
  fmt:
    silent: true
    deps: ['fmt:yaml', 'fmt:toml', 'fmt:rs', 'fmt:swift', 'fmt:js', 'fmt:sql']

  desktop:build: pnpm -F desktop tauri build
  server:dev:
    cmds:
      - docker-compose -f crates/s3/docker-compose.yaml up -d
      - cmd: cargo watch -x 'run -p server'
        ignore_error: true
      - docker-compose -f crates/s3/docker-compose.yaml down
  server:env:
    cmds:
      - |
        secrets=$(grep -v '^#' .env.prod | grep '=' | sed 's/"/\\"/g' | tr '\n' ' ')
        fly secrets set $secrets -a hypr-server
