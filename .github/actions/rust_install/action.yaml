inputs:
  platform:
    required: false
    default: ""
runs:
  using: "composite"
  steps:
    - if: inputs.platform == 'macos'
      uses: dtolnay/rust-toolchain@master
      with:
        toolchain: "1.91.1"
        targets: aarch64-apple-darwin,x86_64-apple-darwin
    - if: inputs.platform == 'ios'
      uses: dtolnay/rust-toolchain@master
      with:
        toolchain: "1.91.1"
        targets: aarch64-apple-ios,x86_64-apple-ios,aarch64-apple-ios-sim
    - if: inputs.platform == 'android'
      uses: dtolnay/rust-toolchain@master
      with:
        toolchain: "1.91.1"
        targets: aarch64-linux-android,armv7-linux-androideabi,i686-linux-android,x86_64-linux-android
    - if: inputs.platform == 'windows'
      uses: dtolnay/rust-toolchain@master
      with:
        toolchain: "1.91.1"
        targets: x86_64-pc-windows-msvc
    - if: inputs.platform == 'windows'
      run: cargo install trusted-signing-cli
      shell: bash
      env:
        GITHUB_TOKEN: ${{ github.token }}
    - if: inputs.platform == 'linux'
      uses: dtolnay/rust-toolchain@master
      with:
        toolchain: "1.91.1"
        targets: x86_64-unknown-linux-gnu,x86_64-unknown-linux-musl,aarch64-unknown-linux-gnu
    - if: inputs.platform == 'linux'
      run: |
        sudo apt-get update
        sudo apt-get install -y gcc-aarch64-linux-gnu libasound2-dev
      shell: bash
    - if: inputs.platform == ''
      uses: dtolnay/rust-toolchain@master
      with:
        toolchain: "1.91.1"
    - uses: Swatinem/rust-cache@v2
      with:
        cache-targets: "true"
