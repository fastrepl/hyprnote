name: Comment Result
description: Post a result comment with markdown table

inputs:
  token:
    description: GitHub token
    required: true
  repo:
    description: Repository (owner/repo)
    required: true
  issue_number:
    description: Issue or PR number
    required: true
  success:
    description: Whether the operation succeeded
    required: true
  title:
    description: Comment title (e.g., "Release triggered", "Staging build triggered")
    required: true
  data:
    description: JSON object with key-value pairs for the table
    required: true

runs:
  using: composite
  steps:
    - id: comment
      shell: bash
      env:
        GH_TOKEN: ${{ inputs.token }}
        DATA: ${{ inputs.data }}
      run: |
        json_to_md_table() {
          echo "$1" | jq -r '
            to_entries |
            ["| Field | Value |", "| --- | --- |"] +
            [.[] | "| \(.key) | \(.value) |"] |
            .[]
          '
        }

        if [ "${{ inputs.success }}" = "true" ]; then
          EMOJI="ðŸš€"
        else
          EMOJI="âŒ"
        fi

        TABLE=$(json_to_md_table "$DATA")
        BODY="$EMOJI ${{ inputs.title }}

        $TABLE"
        BODY=$(echo "$BODY" | sed 's/^[[:space:]]*//')

        gh pr comment ${{ inputs.issue_number }} --repo ${{ inputs.repo }} --body "$BODY" 2>/dev/null || \
        gh issue comment ${{ inputs.issue_number }} --repo ${{ inputs.repo }} --body "$BODY"
